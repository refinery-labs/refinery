<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Refinery - A Pipeline Editor</title>
    <link rel="stylesheet" type="text/css" href="./css/main.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<body>
    <div id="app">
    	<!-- modals -->
    	
    	<!-- TODO Modal - for finished stuff -->
		<div class="modal fade" id="todo_output" tabindex="-1" role="dialog" aria-labelledby="todo_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="todo_label">TODO</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<center>
							<h1>This has not been implemented yet!</h1>
						</center>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
		
    	<!-- Deploy diagram output -->
		<div class="modal fade" id="deploydiagram_output" tabindex="-1" role="dialog" aria-labelledby="deploydiagram_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="deploydiagram_label">Infrastructure Deployment Results</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		            </div>
		            <div class="modal-body">
		            	<div v-if="!deploying_infrastructure">
							<b>Build Time: </b><code>{{deploy_infrastructure_time}}</code> seconds
		            	</div>
						<div v-if="deploying_infrastructure">
							<center>
								<img src="/img/loading.gif" />
								<br />
								<i>Building and deploying infrastructure to production, this may take a while...</i>
							</center>
						</div>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
    	
		<!-- View saved function modal -->
		<div class="modal fade" id="viewsavefunction_output" tabindex="-1" role="dialog" aria-labelledby="viewsavefunction_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="viewsavefunction_label">Saved Function</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<div class="form-group">
							<label>Name</label>
							<input type="text" class="form-control" v-model="saved_function_data.name" placeholder="Uppercase Function">
							<small class="form-text text-muted">Name of your saved function.</small>
						</div>
						<div class="form-group">
							<label>Description</label>
							<input type="text" class="form-control" v-model="saved_function_data.description" placeholder="This function uppercases a string input.">
							<small class="form-text text-muted">Description of what the function does.</small>
						</div>
		                <div class="form-group">
		                	<label>Language</label>
							<select class="custom-select" v-model="saved_function_data.language">
								<option value="python2.7" selected>python2.7</option>
								<option value="nodejs8.10">Node v8.10.0 (LTS)</option>
							</select>
							<small id="new_lambda_language_select_input_help" class="form-text text-muted">Language of saved function.</small>
						</div>
						<div class="form-group">
							<label>Import(s)</label>
							<div style="height: 50px">
								<editor editor-id="saved_function_data_imports_view_editor" theme="monokai" lang="python" :content="unformatted_saved_function_libraries" v-on:change-content="saved_function_libraries_changed"></editor>
							</div>
							<small class="form-text text-muted">Libraries for the saved function.</small>
						</div>
	            		<div style="height: 300px">
							<editor editor-id="view_saved_function_editor" theme="monokai" lang="python" :content="saved_function_data.code" v-on:change-content="update_add_function_code"></editor>
	            		</div>
	            		<br />
	            		<center>
	            			<button type="button" class="btn btn-lg btn-primary" v-on:click="update_saved_function" data-dismiss="modal">Update Function</button>
	            			
	            			<button type="button" class="btn btn-lg btn-primary" v-on:click="merge_saved_function" style="margin-left: 10px;" data-dismiss="modal" v-if="page == 'modify-lambda'">Merge into Lambda</button>
	            			
	            			<button type="button" class="btn btn-lg btn-danger" v-on:click="delete_saved_function" style="margin-left: 10px;" data-dismiss="modal">Delete Function</button>
	            		</center>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
    	
		<!-- Search Saved functions modal -->
		<div class="modal fade" id="searchsavedfunction_output" tabindex="-1" role="dialog" aria-labelledby="searchsavedfunction_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="searchsavedfunction_label">Search Saved Functions</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<div class="form-group">
							<label>Search</label>
							<input type="text" class="form-control" placeholder="Code search term" v-model="saved_function_search_query">
							<small class="form-text text-muted">Free text search of saved function.</small>
						</div>
						<hr />
						<table class="table table-striped">
							<thead>
								<tr>
									<th scope="col" style="width: 175px;">Name</th>
									<th scope="col">Description</th>
									<th scope="col" style="width: 210px">Language</th>
									<th scope="col" style="width: 90px; text-align: center;"></th>
								</tr>
							</thead>
							<tbody>
								<tr class="search-result-row" v-for="saved_function_search_result in saved_function_search_results">
									<th scope="row">{{saved_function_search_result.name}}</th>
									<td>{{saved_function_search_result.description}}</td>
									<td>{{saved_function_search_result.language}}</td>
									<td>
										<button type="button" class="btn btn-primary" v-bind:id="saved_function_search_result.id" v-on:click="view_saved_function" data-dismiss="modal">Open</button>
									</td>
								</tr>
							</tbody>
						</table>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
    	
		<!-- Create new saved function modal -->
		<div class="modal fade" id="savefunction_output" tabindex="-1" role="dialog" aria-labelledby="savefunction_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="savefunction_label">Save New Function</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<div class="form-group">
							<label>Name</label>
							<input type="text" class="form-control" v-model="saved_function_data.name" placeholder="Uppercase Function">
							<small class="form-text text-muted">Name of your saved function.</small>
						</div>
						<div class="form-group">
							<label>Description</label>
							<input type="text" class="form-control" v-model="saved_function_data.description" placeholder="This function uppercases a string input.">
							<small class="form-text text-muted">Description of what the function does.</small>
						</div>
		                <div class="form-group">
		                	<label>Language</label>
							<select class="custom-select" v-model="saved_function_data.language">
								<option value="python2.7" selected>python2.7</option>
								<option value="nodejs8.10">Node v8.10.0 (LTS)</option>
							</select>
							<small id="new_lambda_language_select_input_help" class="form-text text-muted">Language of saved function.</small>
						</div>
						<div class="form-group">
							<label>Import(s)</label>
							<div style="height: 50px">
								<editor editor-id="saved_function_data_imports_editor" theme="monokai" lang="python" :content="unformatted_saved_function_libraries" v-on:change-content="saved_function_libraries_changed"></editor>
							</div>
							<small class="form-text text-muted">Libraries for the saved function.</small>
						</div>
	            		<div style="height: 300px">
							<editor editor-id="saved_function_editor" theme="monokai" lang="python" :content="saved_function_data.code" v-on:change-content="update_add_function_code"></editor>
	            		</div>
	            		<br />
	            		<center>
	            			<button type="button" class="btn btn-lg btn-primary" v-on:click="saved_new_add_function" data-dismiss="modal">Save New Function</button>
	            		</center>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
    	
    	<!-- Change Project Name -->
		<div class="modal fade" id="project_name_rename_output" tabindex="-1" role="dialog" aria-labelledby="project_name_rename_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="project_name_rename_label">Project Name</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<div class="form-group">
							<label for="project_name">Project Name</label>
							<input type="text" class="form-control" v-model="project_name" aria-describedby="project_name" placeholder="Example Project">
							<small id="selected_state_help" class="form-text text-muted">Name of the project.</small>
						</div>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Import project modal -->
		<div class="modal fade" id="importproject_output" tabindex="-1" role="dialog" aria-labelledby="importproject_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="importproject_label">Import Project Data</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
		            	<center>
		            		<h2>Upload Project JSON</h2>
							<div class="custom-file">
								<input type="file" class="custom-file-input" id="project_file_upload">
								<label class="custom-file-label" for="project_file_upload">Choose file</label>
							</div>
		            		<hr />
		            		<h2>Paste Project JSON Below</h2>
		            		<p v-if="import_paste_error" class="import-error-text"><i>{{import_paste_error}}</i></p>
		            		<div style="height: 300px">
								<editor editor-id="project_data_json_import" theme="monokai" lang="json" :content="project_data_json" v-on:change-content="project_import_data_change"></editor>
		            		</div>
		            	</center>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
		
    	<!-- Export project modal -->
		<div class="modal fade" id="exportproject_output" tabindex="-1" role="dialog" aria-labelledby="exportproject_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="exportproject_label">Exported Project Data</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
		            	<center>
		            		<button type="button" class="btn btn-lg btn-primary" v-on:click="download_project_data">Download Project Data</button>
		            		<hr />
		            		<div style="height: 300px">
								<editor editor-id="project_data_json_export" theme="monokai" lang="json" :content="project_data_json" v-on:change-content="project_export_data_change"></editor>
		            		</div>
		            	</center>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>

		<!-- Fullscreen lambda code editor -->
		<div class="modal fade" id="lambda_editor_popup" tabindex="-1" role="dialog" aria-labelledby="lambda_editor_popup_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg modal-full-screen" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="lambda_editor_popup_label">Edit Lambda</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
						<div style="height: 750px">
							<editor editor-id="lambda_code_large" theme="monokai" v-bind:lang="ace_language_to_lang_id_map[lambda_language]" :content="lambda_code" v-on:change-content="lambda_code_change"></editor>
						</div>
		            </div>
		            <div class="modal-footer">
		            	<button type="submit" class="btn btn-primary" v-on:click="run_tmp_lambda">Run Lambda</button>
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
    	
    	<!-- Run Lambda Output -->
		<div class="modal fade" id="runtmplambda_output" tabindex="-1" role="dialog" aria-labelledby="runtmplambda_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="runtmplambda_label">Lambda Execution Results</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		            </div>
		            <div class="modal-body">
		            	<div v-if="lambda_exec_result && !lambda_exec_result.is_error">
							<b>Build Time: </b><code>{{lambda_build_time}}</code> seconds
							<br />
							<center>
								<h3>Lambda Full Output</h3>
							</center>
							<p>
								<pre style="background-color: #000000; color: #FFFFFF !important; border-radius: 4px; padding: 10px">{{lambda_exec_result.logs}}</pre>
							</p>
							<hr />
							<center>
								<h3>Execution Returned Data</h3>
							</center>
							<p>
								<pre style="background-color: #000000; color: #FFFFFF !important; border-radius: 4px; padding: 10px">{{lambda_exec_result.response}}</pre>
							</p>
		            	</div>
		            	<div v-if="lambda_exec_result && lambda_exec_result.is_error">
							<b>Build Time: </b><code>{{lambda_build_time}}</code> seconds
							<br />
							<b>Error Type: </b><code>{{lambda_exec_result.error.type}}</code>
							<br />
							<b>Error Message: </b><code>{{lambda_exec_result.error.message}}</code>
							<br />
							<hr />
							<center>
								<h3>Full Error Logs</h3>
							</center>
							<p>
								<pre style="background-color: #000000; color: #FFFFFF !important; border-radius: 4px; padding: 10px">{{lambda_exec_result.logs}}</pre>
							</p>
		            	</div>
						<div v-if="!lambda_exec_result">
							<center>
								<img src="/img/loading.gif" />
								<br />
								<i>Building and executing lambda, this may take a few seconds...</i>
							</center>
						</div>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Deploy Lambda output -->
		<div class="modal fade" id="deploylambda_output" tabindex="-1" role="dialog" aria-labelledby="deploylambda_label" aria-hidden="true">
		    <div class="modal-dialog modal-lg" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="deploylambda_label">Deploy Lambda</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        			<span aria-hidden="true">&times;</span>
		        		</button>
		            </div>
		            <div class="modal-body">
		            	<div v-if="!lambda_deploy_loading">
							<b>Build Time: </b><code>{{lambda_build_time}}</code> seconds
							<hr />
							<center>
								<button type="button" class="btn btn-lg btn-primary" v-on:click="open_deployed_lambda_page">Open AWS Lambda Page</button>
								<div v-if="cloudwatch_event_link">
									<hr />
									<button type="button" class="btn btn-lg btn-primary" v-on:click="open_cloudwatch_trigger_page">View AWS CloudWatch Trigger</button>
								</div>
								<div v-if="sqs_queue_link">
									<hr />
									<button type="button" class="btn btn-lg btn-primary" v-on:click="open_sqs_queue_page">View AWS SQS Trigger</button>
								</div>
							</center>
		            	</div>
						<div v-if="lambda_deploy_loading">
							<center>
								<img src="/img/loading.gif" />
								<br />
								<i>{{lambda_deploy_status_text}}</i>
							</center>
						</div>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Header -->
        <div id="header">
			<nav class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: #eee !important;">
				<a class="navbar-brand" href="#" v-on:click="navigate_page('welcome')">
					Refinery
				</a>
			    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
				</button>
			    <div class="collapse navbar-collapse">
			        <ul class="navbar-nav">
			            <li class="nav-item">
			                <a class="nav-link project-name" href="#" v-on:click="show_rename_project_modal">
			                	<i>{{project_name}}</i>
			                </a>
			            </li>
			            <li class="nav-item">
			                
			            </li>
			        </ul>
			    </div>
			    <div class="form-inline my-2 my-lg-0">
					<div class="btn-group">
						<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin-right: 5px;">
							Add New Resource
						</button>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="#" v-on:click="add_lambda_node">Lambda</a>
							<a class="dropdown-item" href="#" v-on:click="add_sns_topic_node">SNS Topic Trigger</a>
							<a class="dropdown-item" href="#" v-on:click="add_sqs_node">SQS Queue Trigger</a>
							<a class="dropdown-item" href="#" v-on:click="add_timer_trigger_node">Time Trigger</a>
						</div>
					</div>
			    	<button type="button" class="btn btn-primary" v-on:click="view_add_function_modal" style="margin-right: 5px;">Add Function</button>
			    	<button type="button" class="btn btn-primary" v-on:click="view_search_functions_modal" style="margin-right: 5px;">Function Lookup</button>
			    	<button type="button" class="btn btn-primary" v-on:click="import_project_data" style="margin-right: 5px;">Import Project</button>
			    	<button type="button" class="btn btn-primary" v-on:click="export_project_data" style="margin-right: 5px;">Export Project</button>
			    	<button type="button" class="btn btn-primary" v-on:click="view_refinery_atc" style="margin-right: 5px;">ATC</button>
			    	<button type="button" class="btn btn-primary" v-on:click="deploy_infrastructure" style="margin-left: 10px;">Deploy to Production</button>
			    </div>
			</nav>
        </div>
        
        <!-- Body -->
        <div id="panes" class="split split-horizontal">
        	
        	<!-- Welcome panel -->
            <div v-if="page == 'welcome'" class="split left-panel">
            	<center>
            		<h2>Welcome to Refinery!</h2>
            		<i>Please select a menu option to start.</i>
            	</center>
            </div>
            
            <!-- Add state transition -->
            <div v-if="page == 'add-state-transition' || page == 'modify-state-transition'" class="split left-panel">
            	<div>
					<h2 v-if="page == 'add-state-transition'">Add State Transition</h2>
					<h2 v-if="page == 'modify-state-transition'">Modify State Transition</h2>
					<hr />
					<div v-if="page == 'modify-state-transition'">
						<button type="submit" class="btn btn-danger" style="width: 100%" v-on:click="delete_state_transition">Delete State Transition</button>
						<hr />
					</div>
					<div class="form-group">
						<label>Transition Type</label>
						<select class="form-control" v-model="state_transition_conditional_data.type" v-if="!is_simple_transition()">
							<option v-for="transition_type in available_transition_types" v-bind:value="transition_type">{{transition_type}}</option>
						</select>
						<select class="form-control" v-model="state_transition_conditional_data.type" v-if="is_simple_transition()">
							<option value="then">then</option>
						</select>
						<small class="form-text text-muted">Type of transition (e.g. <code>if</code> for conditional, <code>then</code> for regular transition).</small>
					</div>
					<div class="form-group" v-if="state_transition_conditional_data.type == 'if'">
						<label>Conditional Expression</label>
						<div style="height: 100px">
							<editor editor-id="condition_expression_editor" theme="monokai" lang="python" :content="state_transition_conditional_data.expression" v-on:change-content="conditional_data_expression_change"></editor>
						</div>
						<small class="form-text text-muted"><b>IMPORTANT: </b>This is the conditional statement code which should evaluate to <code>true</code> if the condition path should be followed or <code>false</code> if it should not. The <code>return_data</code> variable will automatically be populated with your Lambda's returned data. This conditional statement <b>must</b> be written in the language the Lambda was written in.</small>
					</div>
					<div class="form-group">
						<label>Name</label>
						<input type="text" class="form-control" v-model="state_transition_conditional_data.name" placeholder="then">
						<small id="selected_state_help" class="form-text text-muted">Name/label of the transition.</small>
					</div>
					<div class="form-group">
						<label for="selected_state">Selected State</label>
						<input type="text" class="form-control" v-bind:value="selected_transition_start_node.name" aria-describedby="selected_state" disabled>
						<small id="selected_state_help" class="form-text text-muted">The currently selected node you're adding a transition to.</small>
					</div>
					<div class="form-group">
						<label for="next_state">Next State</label>
						<select id="next_state" class="form-control" v-model="state_transition_conditional_data.next">
							<option v-for="workflow_state in valid_transition_paths" v-if="workflow_state.id != selected_node_data.id" v-bind:value="workflow_state.id">{{workflow_state.name}}</option>
						</select>
						<small id="next_state_help" class="form-text text-muted">The next state to transition to after this one.</small>
					</div>
					<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="add_state_transition" v-if="page == 'add-state-transition'">Add State Transition</button>
					<hr />
					<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="update_state_transition" v-if="page == 'modify-state-transition'">Update State Transition</button>
            	</div>
            </div>
            
            <!-- Schedule trigger panel -->
            <div v-if="page == 'modify-schedule_trigger'" class="split left-panel">
				<h2>Schedule Trigger</h2>
				<div class="form-group">
					<label for="trigger_name">Trigger Name</label>
					<input type="text" class="form-control" v-model="scheduled_trigger_data.name" aria-describedby="trigger_name" placeholder="Trigger_Name">
					<small class="form-text text-muted">Name of the trigger.</small>
				</div>
				<div class="form-group">
					<label for="schedule_expression">Schedule Expression</label>
					<input type="text" class="form-control" v-model="scheduled_trigger_data.schedule_expression" aria-describedby="schedule_expression" placeholder="rate(10 minutes)">
					<small class="form-text text-muted">AWS schedule expression for when this trigger should be activated.</small>
				</div>
				<div class="form-group">
					<label for="trigger_description">Description</label>
					<input type="text" class="form-control" v-model="scheduled_trigger_data.description" aria-describedby="trigger_description" placeholder="Example scheduled rule description.">
					<small class="form-text text-muted">Description for the trigger.</small>
				</div>
				<div class="form-group">
					<label>Input Data</label>
					<div style="height: 100px">
						<editor editor-id="sfn_input_data" theme="monokai" lang="python" :content="scheduled_trigger_data.unformatted_input_data"></editor>
					</div>
					<small class="form-text text-muted">Input data for the target being triggered.</small>
				</div>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="update_schedule_trigger">Update Schedule Trigger</button>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="create_new_state_transition">Add Transition</button>
                <hr />
                <button type="submit" class="btn btn-danger" style="width: 100%" v-on:click="delete_node">Delete Schedule Trigger</button>
			</div>
			
            <!-- SNS Topic Node Panel -->
            <div v-if="page == 'modify-sns_topic'" class="split left-panel">
				<h2>SNS Topic Trigger</h2>
				<div class="form-group">
					<label>Topic Name</label>
					<input type="text" class="form-control" v-model="sns_trigger_data.topic_name" placeholder="Example Topic">
					<small class="form-text text-muted">Name of the SNS topic linked to the Lambda.</small>
				</div>
				<div class="form-group">
					<label>SNS Message Format</label>
					<div style="height: 200px">
						<editor editor-id="sns_topic_template_" theme="monokai" lang="json" :content="sns_trigger_data.sns_topic_template" v-on:change-content="update_sns_topic_template"></editor>
					</div>
					<small class="form-text text-muted">A template of an example message to be added to this SNS topic. This is important for ensuring the triggered Lambda receives the appropriate input!</small>
				</div>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="update_sns_topic">Update SNS Topic</button>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="create_new_state_transition">Add Transition</button>
                <hr />
                <button type="submit" class="btn btn-danger" style="width: 100%" v-on:click="delete_node">Delete SNS Topic</button>
			</div>
            
            <!-- SQS Queue Node Panel -->
            <div v-if="page == 'modify-sqs_queue'" class="split left-panel">
				<h2>SQS Queue Trigger</h2>
				<div class="form-group">
					<label for="sqs_queue_name">Queue Name</label>
					<input type="text" class="form-control" v-model="sqs_trigger_data.queue_name" aria-describedby="sqs_queue_name" placeholder="Example Queue">
					<small class="form-text text-muted">Name of the SQS queue linked to the Lambda.</small>
				</div>
				<div class="form-group">
					<label>Batch Size</label>
					<div class="form-group">
						<div class="input-group mb-2">
							<input type="number" class="form-control form-control-lg" v-model="sqs_trigger_data.batch_size" placeholder="1" step="1" min="1" max="10">
							<div class="input-group-append">
								<div class="input-group-text">Message(s)</div>
							</div>
						</div>
					</div>
					<small class="form-text text-muted">Number of messages to pass to Lambda at a time (max 10).</small>
				</div>
				<div class="form-group">
					<input type="checkbox" v-model="sqs_trigger_data.content_based_deduplication"> <label>Content-Based De-duplication</label>
					<small class="form-text text-muted">Should messages be de-duplicated based off of their message contents (5 minute rolling window)?</small>
				</div>
				<div class="form-group">
					<label>SQS Job Format</label>
					<div style="height: 200px">
						<editor editor-id="sqs_trigger_job_template_" theme="monokai" lang="json" :content="sqs_trigger_data.sqs_job_template" v-on:change-content="update_sqs_job_template"></editor>
					</div>
					<small class="form-text text-muted">A template of an example job to be added to this SQS queue. This is important for ensuring the triggered Lambda receives the appropriate input!</small>
				</div>
				
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="update_sqs_queue">Update SQS Queue</button>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="create_new_state_transition">Add Transition</button>
                <hr />
                <button type="submit" class="btn btn-danger" style="width: 100%" v-on:click="delete_node">Delete SQS Queue</button>
			</div>
            
            <!-- Modify Lambda panel -->
            <div v-if="page == 'modify-lambda'" class="split left-panel">
                <h2>Modify Lambda</h2>
                <hr />
                <div class="form-group">
                    <label for="new_lambda_name_input">Name</label>
                    <input type="text" class="form-control" v-model="lambda_name" aria-describedby="new_lambda_name_input_help" placeholder="Write to S3">
                    <small id="new_lambda_name_input_help" class="form-text text-muted">Name of the lambda function.</small>
                </div>
                <div class="form-group">
                	<label for="new_lambda_language_select_input">Language</label>
					<select class="custom-select" v-model="lambda_language" @change="lambda_language_manual_change" aria-describedby="new_lambda_language_select_input_help">
						<option value="python2.7">python2.7</option>
						<option value="nodejs8.10">Node v8.10.0 (LTS)</option>
					</select>
					<small id="new_lambda_language_select_input_help" class="form-text text-muted">Language of lambda function.</small>
				</div>
				<div class="form-group">
					<label>Import(s)</label>
					<div style="height: 100px">
						<editor editor-id="unformatted_libraries" theme="monokai" lang="python" :content="unformatted_libraries" v-on:change-content="lambda_libraries_change"></editor>
					</div>
					<small class="form-text text-muted">Dependencies for the lambda code.</small>
				</div>
				<div class="form-group">
					<label>Code</label>
					<div style="height: 100px">
						<editor editor-id="lambda_code" theme="monokai" v-bind:lang="ace_language_to_lang_id_map[lambda_language]" :content="lambda_code" v-on:change-content="lambda_code_change"></editor>
					</div>
					<div style="text-align: right">
						<button type="button" style="width: 100%" class="btn btn-sm btn-secondary" v-on:click="fullscreen_lambda_editor">View Fullscreen</button>
					</div>
					<small class="form-text text-muted">Code of lambda function.</small>
				</div>
				<div class="form-group">
					<label>Execution Memory</label>
					<div class="form-group">
						<div class="input-group mb-2">
							<input type="number" class="form-control form-control-lg" v-model="lambda_memory" placeholder="128" step="64" min="128" max="3008">
							<div class="input-group-append">
								<div class="input-group-text">MB</div>
							</div>
						</div>
					</div>
					<small class="form-text text-muted">Maximum memory for the Lambda to use during execution.</small>
				</div>
				<div class="form-group">
					<label>Max Execution Time</label>
					<div class="form-group">
						<div class="input-group mb-2">
							<input type="number" class="form-control form-control-lg" v-model="lambda_max_execution_time" placeholder="60" step="1" min="2" max="300">
							<div class="input-group-append">
								<div class="input-group-text">Second(s)</div>
							</div>
						</div>
					</div>
					<small class="form-text text-muted">Maximum time the Lambda may execute before being killed in seconds.</small>
				</div>
                <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="update_lambda">Update Lambda</button>
                <hr />
                <button type="submit" class="btn btn-danger" style="width: 100%" v-on:click="delete_node">Delete Lambda</button>
                <hr />
                <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="create_new_state_transition">Add Transition</button>
                <hr />
                <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="run_tmp_lambda">Run Lambda</button>
                <hr />
                <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="duplicate_lambda">Duplicate Lambda</button>
                <hr />
                <!-- <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="select_trigger('lambda')">Deploy Lambda</button> -->
            </div>
            
            <!-- Refinery ATC Homepage Panel -->
            <div v-if="page == 'atc'" class="split left-panel">
                <h2>Refinery ATC</h2>
                <hr />
                <button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="view_atc_create_loader">Add Queue Loader</button>
                <hr />
				<div v-for="queue_loader in atc.running_queue_loaders">
					<b>Queue Loader ID: </b> <code>{{queue_loader.id}}</code><br />
					<b>Queue Name: </b> <code>{{queue_loader.queue_name}}</code><br />
					<b>Iterators: </b>
					<ul>
						<li v-for="iterator_options in queue_loader.iterators_options_array">Iterator: <code>{{iterator_options.iterator_function}}</code>
							<ul>
								<li>
									Key: <code>{{iterator_options.template_key}}</code>
								</li>
								<li>
									Role: <code>{{iterator_options.type}}</code>
								</li>
								<li>
									Config: <p style="white-space: nowrap; text-overflow: ellipsis; max-width: 40ch; overflow: hidden;">
										<code>{{JSON.stringify( iterator_options.arguments )}}</code>
									</p>
								</li>
							</ul>
						</li>
					</ul>
					<button type="submit" class="btn btn-danger" style="width: 100%; margin-bottom: 5px;" v-on:click="kill_job_loader(queue_loader.id)">Kill Job Loader</button>
					<hr />
				</div>
            </div>
            
            <!-- Refinery ATC Add Loader Panel -->
            <div v-if="page == 'atc-queue-loader'" class="split left-panel">
                <h2>Queue Loader</h2>
                <hr />
                <div class="form-group">
                	<label>SQS Queue</label>
					<select class="custom-select" v-model="atc.queue_loader.queue_name">
						<option v-bind:value="queue_name" v-for="queue_name in atc.sqs_queues">{{queue_name}}</option>
					</select>
					<small id="new_lambda_language_select_input_help" class="form-text text-muted">The SQS queue to publish generated jobs to.</small>
				</div>
				<div class="form-group">
					<label>Job Template</label>
					<div style="height: 100px">
						<editor editor-id="atc_job_template_editor" theme="monokai" lang="json" :content="atc.unformatted_job_template_text" v-on:change-content="atc_job_template_text_changed"></editor>
					</div>
					<small class="form-text text-muted">Job Template</small>
				</div>
                <div class="form-group">
                    <label>Cron Expression</label>
                    <input type="text" class="form-control" v-model="atc.queue_loader.options.method_data.expression" placeholder="* * * * * *">
                    <small class="form-text text-muted">Valid Cronjob expression for how often the loader should run a round. Note: This can also be just the string <code>immediate</code> if all data should be loaded at once.</small>
                </div>
				<div class="form-group" v-if="atc.queue_loader.options.method_type === 'cron'">
					<label>Cycle(s) Per Round</label>
					<div class="input-group mb-2">
						<input type="number" class="form-control form-control-lg" v-model.number="atc.queue_loader.options.cycles" placeholder="1" step="1" min="1">
						<div class="input-group-append">
							<div class="input-group-text">Cycle(s)</div>
						</div>
					</div>
					<small class="form-text text-muted">Number of cycles to run each round (basically, how many times should the iterators be run through each round).</small>
				</div>
				
				<h3>Job Iterator(s)</h3>
				<div v-if="!atc.queue_loader.iterators_options_array.length">
					<i>No iterators are set, perhaps you should add some?</i>
				</div>
				<div v-if="atc.queue_loader.iterators_options_array.length">
					<div v-for="(iterators_option, index) in atc.queue_loader.iterators_options_array">
						<hr />
		                <div class="form-group">
		                	<label>Iterator</label>
							<select class="custom-select" v-model="iterators_option.iterator_function">
								<option v-bind:value="iterator.id" v-for="iterator in atc.iterators">{{iterator.name}}</option>
							</select>
							<small class="form-text text-muted">Custom iterator type which is controlled by the Arguments specified below.</small>
						</div>
		                <div class="form-group">
		                	<label>Type</label>
							<select class="custom-select" v-model="iterators_option.type">
								<option value="primary">Primary</option>
								<option value="supporting">Supporting</option>
							</select>
							<small class="form-text text-muted"><code>Primary</code> iterators will cause the job generation to finish when they have been exhausted. <code>Supporting</code> iterators will not and will instead restart from their starting state when they are exhausted (e.g. loop around).</small>
						</div>
		                <div class="form-group">
		                    <label>Job Template Key</label>
		                    <input type="text" class="form-control" v-model="iterators_option.template_key" placeholder="key">
		                    <small class="form-text text-muted">The key who's value will be set on the above Job Template by the iterator.</small>
		                </div>
						<div class="form-group">
							<label>Iterator Config</label>
							<div style="height: 100px">
								<editor v-bind:arg_index="index" v-bind:editor-id="'atc_iterator_arguments_editor' + index.toString()" theme="monokai" lang="json" :content="JSON.stringify( atc_get_arguments_by_iterator_id( iterators_option.iterator_function ),false,4)" v-on:change-content-context="atc_update_arguments"></editor>
							</div>
							<small class="form-text text-muted">This is the config data which changes how the iterator operates.</small>
						</div>
						<button type="submit" class="btn btn-danger" style="width: 100%; margin-bottom: 5px;" v-bind:iterator_index="index" v-on:click="delete_iterator(index)">Delete Iterator</button>
					</div>
				</div>
				<hr />
				<button type="submit" class="btn btn-primary" style="width: 100%" v-on:click="add_iterator">Add Iterator</button>
				<hr />
				<button v-if="atc.queue_loader.iterators_options_array.length" type="submit" class="btn btn-primary" style="width: 100%; height: 50px" v-on:click="create_queue_loader">Create Queue Loader</button>
				<button v-if="!atc.queue_loader.iterators_options_array.length" type="submit" class="btn btn-primary" style="width: 100%; height: 50px" disabled>Create Queue Loader</button>
            </div>
            
            <!-- Graph -->
            <div id="graph" class="split">
                <div id="output">
                    <div id="error"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="./js/jquery-3.3.1.min.js"></script>
	<script src="./js/bootstrap.min.js"></script>
    <script src="./js/ace.noconflict.js"></script>
    <script src="./js/viz.js"></script>
    <script src="./js/fabric.min.js"></script>
    <script src="./js/split.min.js"></script>
    <script src="./js/svg-pan-zoom.min.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="./js/main.js"></script>
</body>

</html>