$backpack = array();

$_REFINERY_STDIN_HANDLER = fopen('php://stdin', 'r');
$_REFINERY_RAW_INPUT = stream_get_contents( $_REFINERY_STDIN_HANDLER );
fclose($_REFINERY_STDIN_HANDLER);

(function( $lambda_data ) {
	global $backpack;
	$input_data = json_decode(
		$lambda_data,
		true
	);

	$lambda_input = $input_data[ "lambda_input" ];
	$backpack = $input_data[ "backpack" ];
	
	try {
		$output = main( $lambda_input );
		echo( "\n" );
		echo( "<REFINERY_OUTPUT_CUSTOM_RUNTIME_START_MARKER>".json_encode(array(
			"output" => $output,
			"backpack" => $backpack,
		))."<REFINERY_OUTPUT_CUSTOM_RUNTIME_END_MARKER>" );
		$backpack = array();
		exit(0);
	} catch ( Exception $e ) {
		$error_message = $e->getMessage();
		echo( "<REFINERY_ERROR_OUTPUT_CUSTOM_RUNTIME_START_MARKER>".json_encode(array( "output" => $error_message, "backpack" => $backpack))."<REFINERY_ERROR_OUTPUT_CUSTOM_RUNTIME_END_MARKER>" );
		$backpack = array();
		exit(-1);
	}
})( $_REFINERY_RAW_INPUT );